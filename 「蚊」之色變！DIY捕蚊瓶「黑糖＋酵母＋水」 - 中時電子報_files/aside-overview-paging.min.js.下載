$(function(){var o="data-pageno",f="data-total-page",s="data-category",t=null,e=null,u=null,r=null,i=null,n={url:"",pageAttr:o,queryString:{page:o},sourceCategory:0,totalPageCount:0,pageRange:4,minPageNo:1,maxPageNo:4};$.fn.initPaging=function(o){var c,h;o&&($.extend(n.queryString,o.queryString),c=n.queryString,n=$.extend(n,o),n.queryString=c),r=this;for(h in n.queryString)r.attr("data-"+h,n.queryString[h]);t=$("<div class='paginationnew'></div>"),i=r.find("ul"),n.totalPageCount===0&&i.length>0&&(n.totalPageCount=i.attr(f)?parseInt(i.attr(f)):n.totalPageCount),n.sourceCategory===0&&(n.sourceCategory=r.attr(s)?parseInt(r.attr(s)):n.sourceCategory),n.maxPageNo=Math.min(n.maxPageNo,n.totalPageCount),e=$("<a title='上一頁' class='button left' "+n.pageAttr+"='1'><img src='//cache.chinatimes.com/images/arrow-p.png' /></a>"),u=$("<a title='下一頁' class='button right' "+n.pageAttr+"='"+Math.min(n.maxPageNo,2)+"'><img src='//cache.chinatimes.com/images/arrow-n.png' /></a>"),e.click(t.changePage),u.click(t.changePage),t.append(e).append(u),r.append(t),t.rebuildPaging(n.minPageNo,n.maxPageNo)},$.fn.createPagingLabel=function(t,i,r){var u=$("<a href='javascript:' title='"+i+"' class='"+i+" ecsw "+(r===!0?"on":"")+"' "+n.pageAttr+"='"+i+"'>"+i+"</a>");return u.click(t),u},$.fn.rebuildPaging=function(i,r,f){var e,o;for(t.find("a.ecsw").remove(),e=i;e<=r;e++)o=f?t.createPagingLabel(t.changePage,e,e===f):t.createPagingLabel(t.changePage,e,e===i),o.insertBefore(u);n.maxPageNo=r,n.minPageNo=i},$.fn.changePage=function(){var c=$(this),h="",s,y,v,l,a;for(s in n.queryString)y=s==="page"?c.attr(n.queryString[s]):r.attr("data-"+s)||c.attr("data-"+s)||n.queryString[s],v=s+"="+y,h=h+(h.length===0?"":"&")+v;l=n.url.lastIndexOf("/")<n.url.length-1?n.url:n.url.substr(0,n.url.length-1),a=n.sourceCategory===0||n.sourceCategory.length===0?"":"/"+n.sourceCategory,console.log(l+a+(h.length>0?"?"+h:"")),$.ajax({url:l+a+(h.length>0?"?"+h:""),type:"GET",dataType:"html",success:function(r){var o=parseInt(c.attr(n.pageAttr));e.attr(n.pageAttr,Math.max(1,o-1)),u.attr(n.pageAttr,Math.min(n.totalPageCount,o+1)),o>n.maxPageNo?(n.maxPageNo=Math.min(n.totalPageCount,n.maxPageNo+n.pageRange),t.rebuildPaging(o,n.maxPageNo)):o<n.minPageNo?(n.minPageNo=Math.max(1,n.minPageNo-n.pageRange),t.rebuildPaging(n.minPageNo,o,o)):c.hasClass("button")?(t.find("a.ecsw").removeClass("on"),t.find("a.ecsw["+n.pageAttr+"="+o+"]").addClass("on")):(t.find("a.ecsw").removeClass("on"),c.addClass("on")),i.remove(),i=$(r),i.insertBefore(t),n.totalPageCount=i.attr(f)?parseInt(i.attr(f)):n.totalPageCount}})}})