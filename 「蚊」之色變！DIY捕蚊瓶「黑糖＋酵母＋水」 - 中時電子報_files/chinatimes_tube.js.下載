/*! automatically generated; DO NOT CHANGE : 20:10:00 GMT+0800 (CST) !*/
var _pop=_pop||[];var _popIn5_config={};(function(){var l={};l["collect.pc"]="#_popIn_recommend {         display : none ;     }     ._popIn_recommend_container {         display : none ;     }     .css_selector {         css_attribute : value ;     } ";l["standard.pc"]="._popIn_recommend_container {         padding : 0px 0px 15px 0px ;         position : relative ;         clear : both ;         overflow : hidden ;     }     ._popIn_recommend_header {         color : rgb(18, 155, 244) ;         font : bold 30px/1.3 '微软雅黑', '黑体', 'helvetica neue', 'lucida grande', 'Arial', 'PMingLiU', 'Trebuchet MS', 'Helvetica', 'Verdana', 'sans-serif' ;         margin-bottom : 12px ;     }     ._popIn_noimage a {         background : url(//api.popin.cc/images/noimg.png) no-repeat center ;     }     ._popIn_noimage a img {         display : none ;     }     ._popIn_recommend_art_category {         display : none ;     }     ._popIn_recommend_art_date {         display : none ;     }     ._popIn_recommend_art_img {         width : 100% ;         padding-top : 66.6667% ;         margin-bottom : 7px ;         position : relative ;     }     ._popIn_recommend_art_img a {         position : absolute ;         top : 0px ;         left : 0px ;         margin : 0px ;         width : 100% ;         height : 100% ;         display : inline-block ;         overflow : hidden ;         background-position : top center ;         background-size : cover ;         background-repeat : no-repeat ;         opacity : 0 ;         transition  : opacity 500ms ;         -moz-transition  : opacity 500ms ;         -o-transition  : opacity 500ms ;         -webkit-transition  : opacity 500ms ;     }     ._popIn_recommend_art_img a img {     }     ._popIn_recommend_art_title {         height : 63px ;         font-size : 16px ;         line-height : 20px ;         overflow : hidden ;     }     ._popIn_recommend_art_title a {         height : 63px ;         font-size : 16px ;         line-height : 20px ;         font-family : 'Roboto',arial,sans-serif ;         color : #333333 ;         text-decoration : none ;     }     ._popIn_recommend_article {         display : inline-block ;         width : 32% ;         margin-bottom : 10px ;         position : relative ;         vertical-align : top ;     }     ._popIn_idx1,._popIn_idx4,._popIn_idx7 {         margin : 1% 0px 0px 1% ;     }     ._popIn_idx2,._popIn_idx5,._popIn_idx8 {         margin : 1% 1% 0px 1% ;     }     ._popIn_idx3,._popIn_idx6,._popIn_idx9 {         margin : 1% 0px 0px 0px ;     }     ._popIn_recommend_article:hover > ._popIn_recommend_art_title a {         text-decoration : underline ;     }     ._popIn_recommend_articles {         border : 1px solid #cccccc ;         padding-bottom : 10px ;     }     ._popIn_recommend_no_img {     }     .css_selector {         css_attribute : value ;     }     ._popIn_recommend_art_media {         color : #999 ;         font-size : 10px ;         line-height : 12px ;         font-weight : normal ;     }     ._popIn_recommend_credit:hover {         opacity : 1 ;     }     ._popIn_recommend_credit {         position : absolute ;         right : 5px ;         font-size : 10px ;         opacity : 0.6 ;         bottom : 3px ;     }     ._popIn_recommend_credit_image {         display : inline-block ;         width : 40px ;         height : 10px ;         margin : 1px 0 0 4px ;         background-image : url(//api.popin.cc/images/logo.png) ;         background-repeat : no-repeat ;         background-position : 0px 0px ;         background-size : 40px 20px ;         vertical-align : text-top ;     }     ._popIn_recommend_container:hover ._popIn_recommend_credit_image {         background-position : 0px -10px ;     }     @media screen and (max-width: 767px) {         ._popIn_recommend_article {             width : 49% ;             maring-right : 1% ;         }     }    @media screen and (max-width: 480px) {         ._popIn_recommend_article {             width : 99% ;             maring-right : 1% ;         }     }    ._popIn_recommend_article_ad ._popIn_recommend_art_img a {         background-position : center center ;         XXX-background-size : contain ;         XXX-background-color : #EFEFEF ;         XXX-background-repeat : no-repeat ;     } ";l["standard.mobile"]="div._popIn_infinite_page {         overflow : hidden ;     }     div._popIn_infinite_ad {         padding : 5px 0px ;         border-bottom : 1px solid #CCC ;         line-height : 1 ;         text-align : center ;         box-sizing : initial ;     }     div._popIn_infinite_empty {         display : none ;     }     ._popIn_recommend_container {         margin : 0px ;         padding : 0px 0px 40px 0px ;         position : relative ;         background-color : white ;     }     ._popIn_recommend_header {         color : rgb(18, 155, 244) ;         font : bold 30px/1.3 '微软雅黑', '黑体', 'helvetica neue', 'lucida grande', 'Arial', 'PMingLiU', 'Trebuchet MS', 'Helvetica', 'Verdana', 'sans-serif' ;         margin-bottom : 12px ;     }     ._popIn_recommend_articles {         white-space : nowrap ;     }     ._popIn_recommend_article {         display : block ;         white-space : normal ;         padding : 1% ;         border-bottom : 1px solid #CCC ;         overflow : hidden ;         clear : both ;     }     ._popIn_recommend_art_title {         text-align : left ;         font-size : 16px ;         line-height : 24px ;         padding : 0px ;         overflow : hidden ;     }     ._popIn_recommend_art_title a {         font-size : 16px ;         line-height : 24px ;         font-weight : bolder ;         text-decoration : none ;         color : black ;     }     ._popIn_recommend_art_category {         background : #0E2860 ;         font-size : 10px ;         color : #FFF ;         padding : 3px 7px ;         border-radius : 5px ;         -webkit-border-radius : 5px ;         -moz-border-radius : 5px ;         -ms-border-radius : 5px ;         display : none ;     }     ._popIn_recommend_art_date {         display : none ;     }     ._popIn_recommend_art_media {         text-align : left ;         margin : 0px ;         font-size : 10px ;         color : #999 ;     }     ._popIn_recommend_art_img {         float : left ;         width : 100px ;         height : 68px ;         margin-right : 10px ;     }     ._popIn_recommend_art_img a {         margin : 0px ;         width : 100% ;         height : 100% ;         display : inline-block ;         overflow : hidden ;         background-position : top center ;         background-size : cover ;         opacity : 0 ;         transition  : opacity 500ms ;         -moz-transition  : opacity 500ms ;         -o-transition  : opacity 500ms ;         -webkit-transition  : opacity 500ms ;     }     ._popIn_recommend_no_img {         display : none ;     }     ._popIn_recommend_art_img a img {         __display : none ;     }     ._popIn_recommend_credit {         position : absolute ;         right : 5px ;         font-size : 10px ;         opacity : 0.6 ;         bottom : 20px ;     }     ._popIn_recommend_credit_image {         display : inline-block ;         width : 40px ;         height : 10px ;         margin : 2px 0 0 3px ;         background-image : url(//api.popin.cc/images/logo.png) ;         background-repeat : no-repeat ;         background-position : 0px 0px ;         background-size : 40px 20px ;         vertical-align : text-top ;     }     ._popIn_idx1 {         border-right : solid 1px #ccc ;     }     ._popIn_idx1, ._popIn_idx2 {         width : 48% ;         display : inline-block ;         box-sizing : content-box ;         -webkit-box-sizing : content-box ;         -moz-box-sizing : content-box ;         height : 200px ;         overflow : hidden ;         vertical-align : top ;     }     ._popIn_idx1 ._popIn_recommend_art_img, ._popIn_idx2 ._popIn_recommend_art_img {         display : block ;         float : none ;         width : 100% ;         padding-top : 66.5% ;         height : auto ;         border : none ;         margin : 0px ;         text-align : center ;         overflow : hidden ;         position : relative ;     }     ._popIn_idx1 ._popIn_recommend_art_img a, ._popIn_idx2 ._popIn_recommend_art_img a {         position : absolute ;         top : 0px ;         left : 0px ;         width : 100% ;         height : 100% ;         display : inline-block ;         overflow : hidden ;         background-position : top center ;         background-size : cover ;     }     ._popIn_idx1 ._popIn_recommend_art_title, ._popIn_idx2 ._popIn_recommend_art_title {         display : block ;         margin : 7px 0px 7px 0px ;         height : 72px ;     }     ._popIn_infinite_video {         border-bottom : 1px solid #CCC ;     }     ._popIn_recommend_article_ad ._popIn_recommend_art_img a {         background-position : center center ;         XXX-background-size : contain ;         XXX-background-color : #EFEFEF ;         XXX-background-repeat : no-repeat ;     } ";var n={};n.default_pc=["pattern",["left","ad",4],["rand","ad_reserved",2],["rand","e_ranking",10],["rand","related",10],["rand","cf","hot","pop","recommend",100],[["cf_img","related_img","pop_img","hot_img","recommend_img"],["ad","cf_img","related_img","hot_img","pop_img","related_img","recommend_img"],["ad_reserved","cf_img","related_img","e_ranking_img","related_img","hot_img","pop_img","related_img"],["cf_img","related_img","hot_img","pop_img","related_img"],["ad","cf_img","related_img","hot_img","e_ranking_img","pop_img","related_img"],["cf_img","hot_img","pop_img","related_img","recommend_img"],["ad","cf_img","e_ranking_img","hot_img","pop_img","related_img"],["cf_img","related_img","hot_img","pop_img","related_img"],["ad","cf_img","hot_img","e_ranking_img","pop_img","related_img"]]];n["default"]=["pattern",["left","ad",4],["rand","ad_reserved",2],["rand","e_ranking",50],["rand","cf","hot","pop","related","recommend",50],[["cf_img","related_img","pop_img","hot_img","recommend_img"],["ad_reserved","cf_img","hot_img","pop_img","related_img","recommend_img"],["cf_img","e_ranking","hot","pop","related"],["ad","cf_img","related","hot","pop","related"],["ad","cf_img","hot","e_ranking","pop","related"]]];var o={};if(typeof o.all==="undefined"){o.all={}}o.all["Read"]={mainNode:"article article",readArticle:true,stopNode:".article-source"};if(typeof o.pc==="undefined"){o.pc={}}o.pc["Discovery"]={adVideo:true,adEnable:true,load:"fast",agency:"popin-tw",templates:[{credit:"Recommended by",selector:"article",position:"AfterBegin",title:"",css:l["collect.pc"],type:["rand","related",0],updateImageSelector:"meta[property='og:image']"},{abtestName:"standard",channelId:"standard",dateFormat:"(Y年M月D日)",delWord:"- 中時電子報",delImage:"83e4091fcec6ba869a5eb4637935b08b",mediaFormat:"PR（$MEDIA）",plugins:["Imageback"],afterRender:function(i){},css:l["standard.pc"],imageInView:true,imageSize:"160",position:"AfterBegin",selector:"#_popIn_recommend",credit:"Recommended by",title:location.href.toLowerCase().indexOf("/cn/")>-1?"也许您会感兴趣...":"也許您會感興趣...",infiniteSize:9,infinitePages:1,type:n.default_pc,displayUrlReplace:location.href.indexOf("/m/")>1?[{"chinatimes.com/":"chinatimes.com/m/"}]:[]}],apiUrlAdd:location.href.indexOf("/cn/")>-1?"&country=tw&redirect=true":"&country=tw&redirect=true",apiUrl:"https://tw.popin.cc/popin_discovery/recommend?mode=new&rid=300648&url=%target"};if(typeof o.mobile==="undefined"){o.mobile={}}o.mobile["Discovery"]={adVideo:true,adEnable:true,load:"fast",agency:"popin-tw",templates:[{abtestName:"standard",channelId:"standard",adVideoPosition:1,dateFormat:"(Y年M月D日)",delWord:"- 中時電子報",delImage:"83e4091fcec6ba869a5eb4637935b08b",afterRender:function(i){},css:l["standard.mobile"],imageSize:"160",imageInView:true,infiniteSize:5,infinitePages:5,plugins:["clickall","infinite"],position:"AfterBegin",selector:"#_popIn_recommend",credit:"Recommended by",title:location.href.toLowerCase().indexOf("/cn/")>-1?"也许您会感兴趣...":"也許您會感興趣...",type:n["default"],mediaFormat:"PR（$MEDIA）",displayUrlReplace:location.href.indexOf("/m/")>1?[{"chinatimes.com/":"chinatimes.com/m/"}]:[]}],apiUrlAdd:location.href.indexOf("/cn/")>-1?"&country=tw&redirect=true":"&country=tw&redirect=true",apiUrl:"https://tw.popin.cc/popin_discovery/recommend?mode=new&rid=300648&url=%target"};var j={pid:"chinatimes_tube",urlReplace:[{"[?#].*":""},{"/m/":"/"},{"/CN/":"/cn/"}]};var h=1;h+=(location.href.indexOf("popinlib6=true")>-1?1:0);if(h>0){(function(v,y){if(void 0===y[v]){y[v]=function(){y[v].clients.push(this),this._init=[Array.prototype.slice.call(arguments)]},y[v].clients=[];for(var x=function(i){return function(){return this["_"+i]=this["_"+i]||[],this["_"+i].push(Array.prototype.slice.call(arguments)),this}},w=["addRecord","set","trackEvent","trackPageview","trackClicks","ready"],q=0;q<w.length;q++){var A=w[q];y[v].prototype[A]=x(A)}var z=document.createElement("script");z.type="text/javascript",z.async=!0,z.src=("https:"===document.location.protocol?"https:":"http:")+"//api.popin.cc/td_js_sdk_171.js";var u=document.getElementsByTagName("script")[0];u.parentNode.insertBefore(z,u)}})("Treasure2",window);(function(){if(typeof window.PopIn6!=="undefined"){return}var U=(typeof window._popIn_ad_block_enable!=="undefined"&&window._popIn_ad_block_enable)?"i.popincdn.com":"api.popin.cc";window.PopIn6={uid:"",_tempLog:[],log:function(ak){this._tempLog.push(ak)},event:{},protocol:(/^https:/.test(window.location.protocol)===true)?"https:":"http:",domain:U};if(typeof Array.prototype.forEach==="undefined"){return}if((typeof window.performance!=="undefined")&&(typeof window.performance.getEntries==="function")){PopIn6.__PERFORMANCE_DISCOVERY_INIT__=window.performance.now()}if(typeof Object.assign!="function"){(function(){Object.assign=function(ao){if(ao===undefined||ao===null){throw new TypeError("Cannot convert undefined or null to object")}var al=Object(ao);for(var am=1;am<arguments.length;am++){var an=arguments[am];if(an!==undefined&&an!==null){for(var ak in an){if(Object.prototype.hasOwnProperty.call(an,ak)){al[ak]=an[ak]}}}}return al}})()}var ac=new Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"popin_ads"});ac.set("$global","td_global_id","td_global_id");ac.ready(function(){ac.trackValues=ac.getTrackValues()});window.PopIn6._logger=ac;ab(PopIn6.event);function R(al,ak,ao,an){var am=al.appendChild(document.createElement(ak));if(ao){am.setAttribute("class",ao)}if(an){am.appendChild(document.createTextNode(an))}return am}function v(ak,am){ak=ak||"about:self";am=am||{};var an=(typeof am.pnode!=="undefined"&&typeof am.pnode.nodeValue!=="undefined")?am.pnode:document.body;var al=R(an,"iframe");al.src=ak;al.setAttribute("scrolling","no");al.setAttribute("frameBorder","0");al.setAttribute("allowTransparency","true");(function(ap){ap.display="block";ap.width="0px";ap.height="0px";ap.margin="0px";ap.padding="0px";ap.overflow="none"})(al.style);var ao={element:al,document:al.contentDocument||al.contentWindow.document,window:(al.contentWindow)?al.contentWindow:(al.contentDocument.document)?al.contentDocument.document:al.contentDocument,write:function(ap){ao.document.open();ao.document.write(ap);ao.document.close()}};return ao}function u(ak){var al=ak.getBoundingClientRect();return al.top>0&&window.innerHeight-al.top>0}var W={valid:true};try{[["local",window.localStorage],["session",window.sessionStorage]].forEach(function(al){var ak={};var am=al[1];W[al[0]]=ak;W.valid=W.valid&&!!am.getItem;ak.get=function(an){return am.getItem(an)};ak.set=function(an,ao){am.setItem(an,ao)};ak.remove=function(an){am.removeItem(an)}})}catch(ah){W.valid=false}var J=[];var F=false;function i(al,am){var ak=function(){if(u(al)){am();return true}return false};if(!ak()){J.push(ak)}if(s(J)&&F===false){F=setInterval(function(){if(J.length>0){for(var ao=J.length;ao--;){var an=J[ao]();if(an){J.splice(ao,1)}}}if(J.length===0){clearInterval(F);F=false}},100)}}function s(ak){return typeof ak!=="undefined"&&ak!==""&&ak!==0&&ak!==false&&ak!==null}function A(am,al){if(!s(am)||!s(al)){return am}var ak=am;al.forEach(function(ao){var an=Object.keys(ao);an.forEach(function(ap){ak=ak.replace(new RegExp(ap),ao[ap])})});return ak}var q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!$";function Z(ao){var an=0,aq="",am="";for(var al=0,ap=ao.length;al<ap;al++){am=ao.charCodeAt(al);an=((an<<5)-an)+am;an|=0}for(var ak=0;ak<6;ak++){aq+=q.charAt(an&63);an>>>=6}return aq}function Y(an){var am=an.length,al,ak;while(0!==am){ak=Math.floor(Math.random()*am);am-=1;al=an[am];an[am]=an[ak];an[ak]=al}return an}function B(ak,an){var ao="_p6_"+(Date.now()*100+Math.round(Math.random()*100)).toString(16);window[ao]=function(ap){an(ap);delete window[ao]};var am=document.createElement("script");am.type="text/javascript";am.charset="utf-8";am.async=true;am.src=ak+"&callback="+ao;var al=document.getElementsByTagName("script")[0];al.parentNode.insertBefore(am,al)}function G(){var ak=navigator.userAgent;return[/(tablet|ipad|playbook|silk)|(?!.*android.?_).*(?=android(?!.*mobile))/i].some(function(al){return(ak.match(al))})?"tablet":[/Android/i,/webOS/i,/iPhone/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(function(al){return(ak.match(al))})?"mobile":"pc"}function z(){var ak=window.navigator.userAgent;switch(true){case /Android/.test(ak):return"Android";case /iPhone|iPad|iPod/.test(ak):return"iOS";case /Windows/.test(ak):return"Windows";case /Mac OS X/.test(ak):return"Mac"}return"other"}function ae(al,ak){try{return af(al.split(ak)[1].trim().split(/[^\w\.]/)[0])}catch(am){}return"0.0.0"}function af(ak){var al=ak.split(/[\._]/);return(parseInt(al[0],10)||0)+"."+(parseInt(al[1],10)||0)+"."+(parseInt(al[2],10)||0)}function S(ak,al){switch(al){case"Android":return ae(ak,"Android");case"iOS":return ae(ak,/OS /);case"Windows":return ae(ak,/Phone/.test(ak)?/Windows Phone (?:OS )?/:/Windows NT/);case"Mac":return ae(ak,/Mac OS X /)}return"0.0.0"}function K(ak){switch(true){case /CriOS/.test(ak):return"Chrome for iOS";case /Edge/.test(ak):return"Edge";case /Chrome/.test(ak):return"Chrome";case /Firefox/.test(ak):return"Firefox";case /Android/.test(ak):return"AOSP";case /MSIE|Trident/.test(ak):return"IE";case /Safari\//.test(ak):return"Safari";case /AppleWebKit/.test(ak):return"WebKit";case /Vivaldi/.test(ak):return"Vivaldi"}return""}function V(al,ak){switch(ak){case"Chrome for iOS":return ae(al,"CriOS/");case"Edge":return ae(al,"Edge/");case"Chrome":return ae(al,"Chrome/");case"Firefox":return ae(al,"Firefox/");case"Vivaldi":return ae(al,"Vivaldi/");case"AOSP":return ae(al,/Silk/.test(al)?"Silk/":"Version/");case"IE":return/IEMobile/.test(al)?ae(al,"IEMobile/"):/MSIE/.test(al)?ae(al,"MSIE "):ae(al,"rv:");case"Safari":return ae(al,"Version/");case"Webkit":return ae(al,"WebKit/")}return""}function ag(){var ak=window.screen;try{ak=window.parent.screen}catch(al){}return ak?[ak.width,ak.height].join("x"):"-"}function L(){var am=document.documentElement&&document.documentElement.clientHeight;var ap=document.documentElement&&document.documentElement.clientWidth;var ao=window.innerHeight;var al=window.innerWidth;var ak=am<ao?ao:am;var an=ap<al?al:ap;return an+"x"+ak}function x(){var ao=window.navigator;var al=ao.userAgent;var an=z(al);var ap=S(al,an);var ak=K(al);var am=V(al,ak);return{os:an,os_version:ap,browser:ak,browser_version:am,screen:ag(),viewport:L(),user_agent:window.navigator.userAgent,referrer:document.referrer,path:location.pathname,charset:(document.characterSet||document.charset||"-").toLowerCase(),language:ao&&(ao.language||(ao.language||ao.browserLanguage)||"-").toLowerCase(),color:window.screen?window.screen.colorDepth+"-bit":"-",title:document.title,url:document.location.href.split("#")[0],platform:window.navigator.platform,host:document.location.host}}var aj=x();function D(am){var an=am.split(".");var ak=[];for(var al=an.pop();an.length>0;al=an.pop()){if(al==="www"){break}ak.push(al);if(al.length>3&&ak.length>0){break}}return ak.reverse().join(".")}function T(ak){var al={};if(ak.indexOf("?")>0){qString=ak.substring(ak.indexOf("?"));ak=ak.substring(0,ak.indexOf("?"));qString.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(an,am,ap,ao){al[am]=ao})}return{url:ak,qString:al}}function X(am){var al=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/;var ak=am.match(al);if(ak){return{scheme:ak[1],host:ak[2],path:ak[3],query:ak[4],fragment:ak[5]}}else{return null}}function ab(ak){ak._listeners={};ak.addEventListener=function(al,am){if(!this._listeners[al]){this._listeners[al]=[]}this._listeners[al].push(am)};ak.fireEvent=function(an,am){var al=this;var ao=al._listeners[an];if(s(ao)){ao.forEach(function(ap){ap.apply(al,am)})}}}function r(am){var al=[];al.push('<body style="margin:0px;padding:0px;background-color: transparent;">');al.push("<script>window.inDapIF = true;<\/script>");al.push(am);al.push("</body>");var ak=v("about:self");ak.write(al.join(""))}var C={};C.Class=function(al,ak){this[al]=function(){if(this.init){this.init.apply(this,arguments)}};this[al].prototype=ak};var ad=[];C.Class("ArticlesSelector",{init:function(ak){this.template=ak;this.type=ak.type;this.includeRules=[].concat(this.template.includeRules);this.excludeRules=[].concat(this.template.excludeRules);if(this.template.isClickHistory){this.processCookie(P.cookie)}},getData:function(){var ak=this.process(this.type);var al=this.template.infiniteSize*this.template.infinitePages;return s(ak)?ak.slice(0,Math.min(al,ak.length)):[]},deleteDuplicates:function(ao){var am={};var al=[];function ak(au){for(var ar=0;ar<au.length;ar++){var at=ar+"_"+au[ar];if(am[at]){return false}else{am[at]=1}}return true}ad.forEach(ak);for(var an=0;an<ao.length;an++){var aq=ao[an];var ap=ak(aq.hashData);if(ap){al.push(aq)}}return al},processArticle:function(al,ak){var am=ak.indexOf("ad")>-1;if(s(al.title)&&s(this.template.delWord)&&!am){al.title=al.title.replace(new RegExp(this.template.delWord,"g"),"")}if(s(al.title)){al.title=al.title.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&amp;/g,"&")}if(!s(al.title)){return false}if(al.url===ai.target){return false}if(al.pureUrl===void 0){al.pureUrl=al.url}if(!am){al.url=s(this.template.displayUrlReplace)?A(al.url,this.template.displayUrlReplace):al.url;al.url+=(s(this.template.addQuery)?(((/[?]/.test(al.url))?"&":"?")+this.template.addQuery):"")}al.originalUrl=al.url.indexOf("?url=")>0?decodeURIComponent(T(al.url).qString.url):al.url;if((this.template.delImage&&al.image.indexOf(this.template.delImage)>=0)||(al.image==="noimage")){al.image=""}al.type=ak;al.type2=ak+(al.image?"_img":"_noimg");al.hashData=[Z(al.title),Z(al.originalUrl)];al.formattedDate=(s(al.pubdate)&&al.pubdate!=="000000000000000000")?this.formatDate(al.pubdate):"";if(!this.isValid(al)){return false}return al},formatDate:function(al){var ak=this.template.dateFormat;if(al.slice(8,12)==="0000"&&/h|m|s/.test(ak)){ak=ak.replace(/h|m|s|:|：|\s|時|分|秒/g,"")}var am={Y:[0,4],M:[4,6],D:[6,8],h:[8,10],m:[10,12],s:[12,14]};Object.keys(am).forEach(function(ao){var an=Number(String.prototype.slice.apply(al,am[ao]));if(/m|s/.test(ao)&&an<10){an="0"+an}ak=ak.replace(new RegExp(ao),an)});return ak},isValid:function(an){for(var am=0,aq=this.excludeRules.length;am<aq;am++){var ap=this.excludeRules[am];if(!ap(an)){return false}}for(var al=0,ak=this.includeRules.length;al<ak;al++){var ao=this.includeRules[al];if(ao(an)){return true}}return true},getArticlesByType:function(an){var am=P[an];var ak=[];for(var al=0;al<am.length;al++){var ap=Object.assign({},am[al]);var ao=this.processArticle(ap,an);if(ao){ak.push(ao)}}return ak},process:function(ak){if(typeof ak==="string"&&P[ak]){return this.template.forceProcess?this.getArticlesByType(ak):this.deleteDuplicates(this.getArticlesByType(ak))}if(Array.isArray(ak)){var al=ak[0];if(typeof this[al]==="function"){return this.template.forceProcess?this[al](ak):this.deleteDuplicates(this[al](ak))}}return[]},getMiddle:function(am){var al=[];for(var ak=1;ak<am.length-1;ak++){al=al.concat(this.process(am[ak]))}return al},rand:function(am){var ak=am[am.length-1];var al=Y(this.getMiddle(am));return al.slice(0,Math.min(ak,al.length))},left:function(am){var ak=am[am.length-1];var al=this.getMiddle(am);return al.slice(0,Math.min(ak,al.length))},right:function(am){var ak=am[am.length-1];var al=this.getMiddle(am);return al.slice(Math.max(0,al.length-ak),al.length)},pattern:function(ay){var an=ay[ay.length-1];var av=this.getMiddle(ay);var ax=[];var ak=[].concat(av);var ar=true;while(ar){ar=false;var am=an;while(typeof am==="function"){am=am()}for(var at=0,al=am.length;at<al;at++){var aw=am[at];aw=Array.isArray(aw)?aw:[aw];loop:for(var aq=0,az=aw.length;aq<az;aq++){var aA=aw[aq];for(var ao=0,au=ak.length;ao<au;ao++){var ap=ak[ao];if(ap.type2.search(aA)>-1){ar=true;ax.push(ap);ak.splice(ao,1);break loop}}}}}return ax},processCookie:function(al){var an=al._click;if(!s(an)){return}var am={};var ao=an.split("|");var ak=Date.now();ao.forEach(function(ap){var aq=ap.split(".");var at=aq[1];var ar=(ak-aq[2])/(24*60*60*1000);if(ar>30){return}if(typeof am[at]==="undefined"){am[at]=0}am[at]++});this.addExcludeRuleForAd(am)},addExcludeRuleForAd:function(ak){this.excludeRules.push(function(al){var an=al.type.indexOf("ad")>-1;if(an&s(ak[al.nid])){var am=ak[al.nid];if(am>=3){return false}}return true})}});C.Class("ArticleItem",{init:function(at,aq){for(var am in at){this[am]=at[am]}var ak="";var ap="";var ar=window.PopIn6.protocol;var ao=aq.imageSize;var al=aq.notFoundImg;var au="";this.ad=at.type.indexOf("ad")===0;this.reserved=at.type.indexOf("reserved")>0;if(this.ad){if(s(aq.channelId)){this.url+="&extra=m_ch_"+aq.channelId}this.url+="&api_host="+ai.apiHost;if(s(P.logid)){this.url+="&logid="+P.logid}if(s(PopIn6.smjId)){this.url+="&smjid="+PopIn6.smjId}this.url+="&piuid="+N.getUid();ap=at.image;if(s(ao)&&(""+ao).indexOf("w")===0){ak=ar+"//f.popincdn.com/"+ao+"/";au=ak+ap}else{ak=ar;au=ap.indexOf("http://images.popin.cc")>0?ak+ap.replace(/http:\/\/images.popin.cc/,"//i.popincdn.com"):ap;if(ak==="https:"&&au.indexOf("http://images.popin.cc")>-1){au=au.replace(/http:\/\/images.popin.cc/,"https://i.popincdn.com")}}au=au.replace(/i.popincdn.com/,"imageaws.popin.cc")}else{if(s(ao)&&(""+ao).indexOf("w")===0){ap=at.image_url;ak=ar+"//f.popincdn.com/"+ao+"/";au=ak+ap}else{if(s(ao)&&(""+ao)==="original"){ap=at.image_url;au=ap}else{ap=at.image;if(ap==="noimage"||!s(ap)){ap=""}else{ak=ap.indexOf("http")>-1?"":"https://i.popincdn.com/article/";au=ak+((ao===""||ap.indexOf("http")>-1)?ap:ap.replace(".","_"+ao+"."))}}}}this.image=s(ap)?au:al;var an=T(this.url);this.token=an.qString.token;this.uid=an.qString.uid}});C.Class("ArticleRenderer",{init:function(ak,am,al){this.article=am;this.articleDiv=ak;this.template=al;this.ad=am.type.indexOf("ad")===0;this.render(s(al.channelId)?al.channelId:false)},render:function(ao){var az=this.article;var ak=this.articleDiv;ak.classList.add("_popIn_recommend_article_"+az.type);if(this.template.isFullClick){ak.setAttribute("href",az.url)}if(this.template.addTargetBlank){ak.setAttribute("target","_blank")}if(az.type2.indexOf("_noimg")>-1){ak.classList.add("_popIn_recommend_no_img")}else{ak.classList.add("_popIn_recommend_has_img")}var aw=R(ak,"div","_popIn_recommend_art_img");var an=R(aw,"a");an.href=az.url;an.style.opacity=1;if(this.template.addTargetBlank){an.setAttribute("target","_blank")}var ay=function(){an.style.backgroundImage="url("+az.image+")"};if(this.template.imageInView){i(an,ay)}else{ay()}var al=R(ak,"div","_popIn_recommend_art_title");var ax=R(al,"a",false,az.title);ax.href=az.url;if(this.template.addTargetBlank){ax.setAttribute("target","_blank")}var ar=R(ak,"div","_popIn_recommend_art_category",az.category);if(az.media){var au=R(ak,"div","_popIn_recommend_art_media",this.template.mediaFormat.replace("$MEDIA",az.media))}var av=R(ak,"div","_popIn_recommend_art_date",az.formattedDate);if(az.author_name){var aq=R(ak,"div","_popIn_recommend_art_author",az.author_name)}var am=Array.apply(null,ak.querySelectorAll("a"));if(ak.nodeName==="A"){am.push(ak)}for(var ap=0,at=am.length;ap<at;ap++){this._editLinkNode(am[ap],ao)}},_editLinkNode:function(ak,al){if(this.ad){this._editAdLinkNode(ak)}ak.addEventListener("click",this._onClick.bind(this,al),false)},_editAdLinkNode:function(al){al.target="_blank";al.setAttribute("rel","nofollow");var ak="&mode=20170420&referer_type="+t;if(typeof PopIn6._logger.trackValues!=="undefined"){ak+="&td_client_id="+PopIn6._logger.trackValues.td_client_id}al.href+=ak},_onClick:function(ao,an){var ap=an.currentTarget;an.preventDefault();an.stopPropagation();var al=this.article,ak=(ap.target==="_blank"),am=ap.href;if(/^ad/.test(al.type)===true){this._onClickAd(am,al,ao,ak)}else{this._onClickArticle(am,al,ao,ak)}},_onClickArticle:function(am,al,an,ak){var ao;if(ak){this._openNewTab(am)}else{ao=this._movePage.bind(null,am)}C.Log.articleClickLog(al,ao,{channelId:an})},_onClickAd:function(am,al,an,ak){C.Log.adClickLog(al,{channelId:an});if(s(al.click_tracking_pixel)){r(al.click_tracking_pixel)}if(ak){this._openNewTab(am)}else{this._movePage(am)}},_movePage:function(ak){window.top.location.href=ak},_openNewTab:function(ak){window.open(ak,"_blank")}});C.Class("Box",{init:function(au){var aq=this;this.timeoutId=false;this._canSendChannelImpLog=true;if(!au.selector&&!(au.selector=document.querySelector(au.selectorStr))){if(aq.timeoutId){clearTimeout(aq.timeoutId)}aq.timeoutId=setTimeout(function(){aq.init(au)},200);return}var al=new C.ArticlesSelector(au);var ap=al.getData();if(ap.length>0){var ar=ap.length%au.infiniteSize;if(ar!==0){ap=ap.slice(0,ap.length-ar)}ap.forEach(function(av){ad.push(av.hashData)});this.data=ap}if(ap.length<au.infiniteSize){return}this.template=au;var an=s(au.channelId)?au.channelId:false;this.channelId=an;if(ai.adEnable){C.Log.adRequestLog()}C.Log.previewLog();C.Log.concatenationPVLog();this.renderBox();C.Performance.addTimeMark("box_did_render").addMark("is_box_rendered",true).report();i(this.container,function(){C.Log.boxInViewLog();if(an){C.Log.intextBoxInViewLog({channelId:an})}});if(an){C.Log.intextBoxRenderedLog({channelId:an})}if(s(P.common_category)){(function am(av,ax){try{if(ax<0){return}var aw=PopIn5.$.Context.findContext(av);aw.segmentData.commonCategory=P.common_category;aw.segmentData.mainCategory=encodeURIComponent(P.category)}catch(ay){setTimeout(function(){am(av,--ax)},200)}})(this.container,20)}if(PopIn6.infinite.isEnable&&!PopIn6.infinite.isStart){PopIn6.infinite.isStart=true;PopIn6.event.fireEvent("infinite-loading",[])}var ak=0;var at=function(){if(typeof PopIn5!=="undefined"&&s(PopIn5.$)&&s(PopIn5.$.Config)){PopIn5.$.Config.apiHost=ai.apiHost;clearInterval(ao)}if(ak>10){clearInterval(ao)}ak++};var ao=setInterval(at,500)},renderBox:function(){var al=R(this.template.selector,"div","_popIn_recommend_container");if(s(this.template.containerId)){al.setAttribute("id",this.template.containerId)}this.container=al;var ar=R(al,"div","_popIn_recommend_header",this.template.title);var aA=R(al,"div","_popIn_recommend_articles");var ap=this.data;var an=aA;var aw=this.template.infiniteSize;var az=this.template.infinitePages;for(var aq=0,at=ap.length;aq<at;aq++){var av=Math.floor(aq/aw);var ak=aq%aw;if(av>=az){break}if(ak===0){an=R(aA,"div","_popIn_infinite_page")}var ao=new C.ArticleItem(ap[aq],this.template);ao.renderPosition=aq+1;var ax=this.template.isFullClick?"a":"div";var am=R(an,ax,"_popIn_recommend_article _popIn_idx"+(ak+1));var au=new C.ArticleRenderer(am,ao,this.template);var ay=(au.ad===true)?this._onImpForAd:this._onImpForArticle;i(am,ay.bind(this,ao))}new C.BoxFooter(al,this.template);if(typeof this.template.afterRender==="function"){this.template.afterRender(this)}new C.Video(al,this.template);if(this.template.canInfiniteAds){new C.InfiniteAds(al,this.template)}},_onImpForArticle:function(ak){C.Log.articleInViewLog(ak)},_onImpForAd:function(ak){C.Log.adBoxRenderedLog();var al=this.channelId;if(al&&(this._canSendChannelImpLog===true)){C.Log.intextBoxImpLog({channelId:al});this._canSendChannelImpLog=false}if(s(ak.debug)){return}var am=Math.round((Date.now()-M)/1000);if(am>60*30){return}C.Log.adInViewLog(ak)}});C.Class("BoxFooter",{init:function(al,am){if(am.credit){var ao=R(al,"div","_popIn_recommend_credit",am.credit);var an=R(ao,"div","_popIn_recommend_credit_image");var ak=this;ao.addEventListener("click",function(){if(G()==="mobile"){window.open("https://www.popin.cc/discovery/what-is.php")}else{ak.showCredit()}})}},close:function(){if(s(this.black)){document.body.removeChild(this.black);this.black=false}},showCredit:function(){var ak=this;var ao=function(){ak.close()};var ap=R(document.body,"div");ap.id="_popIn_about_black";(function(aq){aq.position="fixed";aq.width="100%";aq.height="100%";aq.left="0px";aq.top="0px";aq.backgroundColor="rgba(0, 0, 0, 0.75)";aq.zIndex=9998})(ap.style);this.black=ap;ap.addEventListener("click",ao);var am=R(ap,"div");am.id="_popIn_about_inner";(function(aq){aq.position="absolute";aq.width="500px";aq.height="450px";aq.left="50%";aq.top="50%";aq.marginLeft="-250px";aq.marginTop="-225px";aq.backgroundColor="white";aq.borderRadius="6px";aq.zIndex=9999})(am.style);var al=R(am,"div");(function(aq){aq.position="absolute";aq.top="-18px";aq.left="-18px";aq.background="url(https://"+U+"/images/close.png) no-repeat";aq.width="36px";aq.height="36px";aq.cursor="pointer"})(al.style);al.addEventListener("click",ao);var an=R(am,"iframe");an.src="https://www.popin.cc/discovery/what-is.php";an.frameBorder="0";an.scrolling="no";(function(aq){aq.width="480px";aq.height="430px";aq.border="0px";aq.margin="10px 0px 0px 10px"})(an.style)}});C.Class("Config",{init:function(ao){ao=ao||{};this.setDefaults(ao);var al=this.findConfig(o);if(!al){return}for(var an in al){this[an]=al[an]}for(var ak in j){this[ak]=j[ak]}var am=[];if(s(al.templates)){al.templates.forEach(function(ap){am.push(new C.Template(ap))})}this.templates=am;this.afterConfig()},setDefaults:function(ak){this.device=(G()!=="mobile")?"pc":"mobile";this.target=typeof ak!=="undefined"?ak.target||location.href:location.href;this.media=location.host;this.agency="popinag";this.topn=50;this.pathnum=null;this.ad=10;this.country=false;this.apiUrl=window.PopIn6.protocol+"//discoveryplus.popin.cc/popin_discovery/recommend?";this.isArticle=true;this.segmentData={};this.apiUrlAdd=""},afterConfig:function(){var ak=this;this.target=A(this.target,this.urlReplace);var an=[];an.push("device="+this.device);an.push("media="+this.media);an.push("extra="+z().toLowerCase());an.push("agency="+this.agency);an.push("topn="+this.topn);var al=[[s(this.cfid),"cfid="+this.cfid],[s(this.adEnable),"ad="+this.ad],[s(this.pathnum),"pathnum="+this.pathnum],[s(this.apiUrlAdd),this.apiUrlAdd.replace(/^&/,"")],[!s(this.isArticle),"related=false"],[s(PopIn6.smjId),"smjid="+PopIn6.smjId]];al.forEach(function(ao){if(ao[0]){an.push(ao[1])}});this.apiUrl=this.apiUrl.replace("%target",encodeURIComponent(this.target)+"&");if(this.apiUrl.indexOf("url=")===-1){an.push("url="+encodeURIComponent(this.target))}this.apiUrl+=(this.apiUrl.indexOf("?")>-1?(this.apiUrl.slice(-1)!=="?"?"&":""):"?")+an.join("&");var am=this.getUserTdInfo();am.user_device=this.device;am.user_time=Date.now();this.apiUrl+="&info="+btoa(unescape(encodeURIComponent(JSON.stringify(am))));this.apiHost=X(this.apiUrl).host.replace("discoveryplus.","jp.")},findConfig:function(an){var am=(G()!=="mobile")?"pc":"mobile";var al=s(H)?[am+"-test",am,"all-test","all"]:[am,"all"];for(var ak=0;ak<al.length;ak++){var ao=al[ak];if(an[ao]&&an[ao].Discovery){return an[ao].Discovery}}return false},getUserTdInfo:function(){if(!this.userTdData){var am=aj;var al={};for(var ak in am){al["user_td_"+ak]=ak=="title"?encodeURIComponent(am[ak]):am[ak]}this.userTdData=al}return this.userTdData}});C.Class("Criteo",{init:function(ak,al){this.createProxy(ak,al);this.aspectArticleRendererAd();this.aspectDiscoveryLog()},createProxy:function(an,ap){var ar=function(){ap(an)};var am=ai.criteoZoneId||"1097335";var al=ai.criteoCampaignId||"5a1407ff211463e92a72d121";var ao=ai.criteoNId||"5a140913211463152b72d121";var aq=window.PopIn6.protocol+"//cas.criteo.com/delivery/0.1/napi.jsonp?zoneid="+am;var ak=this;B(aq,function(at){if(s(at)&&at.response_status===0||H){return ak.setArticleFromProduct(an,at,ap,am,al,ao)}ar()})},setArticleFromProduct:function(aw,ap,an,am,at,ak){if(H&&ap.response_status!==0){ap={};ap.products=[{title:"Red shoes",description:"Male running shoes",price:"$ 120",click_url:"http://cat.criteo.com/delivery/ck.php",image:{url:"http://images.popin.cc/discovery/667d8c9b2cdfec7b74b19c8d8f9355f7.png",width:160,height:160}},{title:"Blue shoes",description:"Male running shoes.",price:"$ 120",click_url:"http://cat.criteo.com/delivery/ck.php?debug=true",image:{url:"http://images.popin.cc/discovery/667d8c9b2cdfec7b74b19c8d8f9355f7.png",width:160,height:160}}];ap.privacy={optout_click_url:"http://info.criteo.com/pac/privacy/informations",optout_image_url:"http://static.criteo.net/flash/icon/nai_small.png"};ap.advertiser={logo:{url:"http://images.eu.criteo.net/img/img?c=1&l=1&h=70&w=70",width:70,height:70},logo_click_url:"http://cat.criteo.com/delivery/ck.php",description:"Advertiser",domain:"advertiser.com"};ap.impression_pixels=[{url:"http://cat.criteo.com/delivery/lg.php"},{url:"http://www.advertiser.com/impression.gif"}]}aw.ad_criteo=[];var al=Math.min(ap.products.length,aw.ad.length);for(var ao=0;ao<al;ao++){var au=ap.products[ao];var av={};var ar=aw.ad[ao].url;av.criteo=ap;av.criteoProduct=au;av.title=au.title;av.image=au.image.url;av.nid=ak;av.campaign=at;var aq="https://a.popin.cc/popin_redirect/redirect?url={{url}}&nid={{nid}}&campaign={{campaign}}&media={{media}}&device={{device}}&category=criteo&t={{time}}&token={{token}}&uid={{uid}}&nc=1";aq=aq.replace(/{{url}}/,encodeURIComponent(au.click_url));aq=aq.replace(/{{nid}}/,ak);aq=aq.replace(/{{campaign}}/,at);aq=aq.replace(/{{media}}/,ai.media);aq=aq.replace(/{{device}}/,ai.device);aq=aq.replace(/{{time}}/,Date.now());aq=aq.replace(/{{token}}/,Math.random().toString().replace(/\./,""));aq=aq.replace(/{{uid}}/,ar.match(/uid=(.+)/)[1]);av.url=aq;av.userid=ap.advertiser.description;av.domain=ap.advertiser.domain;aw.ad_criteo.push(av)}return an(aw)},aspectArticleRendererAd:function(){var al=C.ArticleRenderer.prototype;var ak=al.render;al.render=function(){if(s(this.article.criteo)){this.article.media=this.article.criteo.advertiser.domain}ak.apply(this,[])};var am=al.addLinkEvent;al.addLinkEvent=function(){am.apply(this,[]);if(s(this.article.criteo)){var aq=this.article;var ar=function(at){if(at.classList.contains("_popIn_3rdparty")){at.href=aq.criteo.privacy.optout_click_url;return}};var ao=Array.prototype.slice.call(this.articleDiv.querySelectorAll("A"));var ap=this.template;var an=this.ad;if(ap.isFullClick){if(!an){ao=[this.articleDiv]}else{ao.push(this.articleDiv)}}ao.forEach(function(at){ar(at)})}}},aspectDiscoveryLog:function(){var ak=C.Log.adInViewLog;var al=C.Log.adRequestLog;var am=function(aq){var ao=aq.impression_pixels;if(!s(ao)){return}for(var ap=0;ap<ao.length;ap++){var an=ao[ap];var ar=new Image();ar.src=an.url}am=function(){}};C.Log.adInViewLog=function(ao){var an=s(ao.criteo)?{common_category:"criteo"}:{};if(s(ao.criteo)){ak.apply(this,[ao,an]);C.Log.adCriteoInViewLog(ao,an);am(ao.criteo)}else{ak.apply(this,[ao,an])}};C.Log.adRequestLog=function(){al.apply(this,[]);C.Log.adCriteoRequestLog()}}});C.Class("CSSManager",{init:function(){this.cache=[];this.css=""},add:function(al){var am=Z(al);var ak=this.cache.some(function(an){return am===an});if(!ak){this.css+=al;this.cache.push(am)}},render:function(){var ak=document.createElement("style");ak.type="text/css";ak.rel="stylesheet";ak.charSet="UTF-8";document.getElementsByTagName("head")[0].appendChild(ak);ak.appendChild(document.createTextNode(this.css))}});C.Class("InfiniteAds",{init:function(ak,al){if(G()!=="mobile"){return}this.container=ak;this.template=al;if(typeof PopIn6.infiniteCounter==="undefined"){PopIn6.infiniteCounter=0}this.ic=s(ai.infiniteSerializeEnable)?PopIn6.infiniteCounter:0;this.slots=this.getSlots();this.ads=this.getAds();if(s(this.slots)&&s(this.ads)){this.renderAds()}},getSlots:function(){var ak=this.container.querySelectorAll("._popIn_infinite_page");var am=[];for(var al=0,ao=ak.length;al<ao;al++){var an=ak[al];if(s(an.querySelector("._popIn_infinite_video"))){continue}am.push(an)}return am},getAds:function(){var ak=[].concat(s(P.infinite)?P.infinite:[]);return ak},renderAds:function(){var ak=this.ic;for(var al=0,ao=this.slots.length;al<ao;al++){var an=this.slots[al];var am=this.ads[ak%this.ads.length];if(s(am)&&am.type==="ad"){this.renderOneAd(an,am)}ak++}PopIn6.infiniteCounter=ak},renderOneAd:function(ap,al){var ao=R(ap,"div","_popIn_infinite_ad");ao.style.height=al.height+"px";var am=[];am.push('<body style="margin:0px;padding:0px;background-color: transparent;">');am.push("<script>window.inDapIF = true;<\/script>");am.push(al.script);am.push("</body>");var ak=v("about:self",{pnode:ao});(function(aq){aq.width=al.width+"px";aq.height=al.height+"px";aq.margin="0px auto"})(ak.element.style);var an=function(){ak.write(am.join(""))};if(s(ai.adInView)){i(ao,an)}else{an()}}});C.Class("Loader",{init:function(){function ao(aq){var av=aq.ad;var au=aq.ad_smj;if(!av||ai.isShowSmjAd===false||!Array.isArray(au)||au.length===0){return}if(av.length===0){aq.ad=au;return}var aw={};var at=0;var ax=[];var ar;while(ar=au[at++]){aw[ar.nid]=1;ar.url+="&smjad=1";ar.isSmjAd=true;ax.push(ar)}at=0;while(ar=av[at++]){if(!aw[ar.nid]){ax.push(ar)}}aq.ad=ax}var al=function(ar){P=ar;PopIn6.event.fireEvent("result-loaded",[ar]);if(!s(PopIn6.uid)&&s(ar)){var au=function(ay){if(W.valid&&s(ay)){W.session.set("_ss_pp_id",ay);W.local.set("_ss_pp_id",ay)}};var av=P.cookie;if(s(av)&&s(av.uid)){PopIn6.uid=av.uid;au(av.uid)}else{var at=v("https://api.popin.cc/retarget/uid.html?ac=getuid");var ax=at.window;window.addEventListener("message",function(ay){if(ax===ay.source){au(ay.data)}},false)}}if(!s(ai.templates)){return}var aq=new C.CSSManager();var aw=ai.templates.filter(function(ay){var az=ay.type.slice(-1)[0];if(typeof az==="number"&&az===0){return false}aq.add(ay.css);return true});aq.render();ao(P);aw.forEach(function(ay){var az=new C.Box(ay)});if(aw.length===0){PopIn6.event.fireEvent("no-content",[])}else{PopIn6.event.fireEvent("start-render",[])}if(ai.isArticle){C.Log.relatedLog();C.Log.snsLog()}PopIn6.event.fireEvent("cehck-update",[P]);return};if(window.context&&(window.context.tagName==="AMP-AD")){PopIn6.event.addEventListener("start-render",function(){setTimeout(function(){var at=document.getElementById("_popIn_amp_recommend");var ar=at.offsetWidth+"px";var aq=at.offsetHeight+"px";window.context.renderStart({width:ar,height:aq})},1)});PopIn6.event.addEventListener("no-content",function(){window.context.noContentAvailable()});window.context.onResizeDenied(function(ar,aq){setTimeout(function(){window.context.requestResize(aq,ar)},500)})}var an=function(){C.Performance.addTimeMark("api_will_request");var au=ai.thirdParty;var aq=false;if(s(au)){var ar=function(aw,av,ax){return aw.indexOf("criteo")>-1};aq=au.some(ar)}if(aq){var at=al;al=function(av){new C.Criteo(av,at)}}B(ai.apiUrl,function(av){if(H>0){window._popIn_discovery_test={result:av,callback:al};var ax=document.createElement("script");ax.type="text/javascript";ax.charset="UTF-8";ax.async=true;ax.src="https://i.popincdn.com/test/discovery_test6.js";var aw=document.getElementsByTagName("script")[0];aw.parentNode.insertBefore(ax,aw);return}else{C.Performance.addTimeMark("api_data_will_deal");al(av)}})};an();if(s(ai.templates)){var am=ai.templates.some(function(aq){return s(aq.selectorStr)&&aq.selectorStr==="._popIn_recommend"});PopIn6.infinite={};PopIn6.infinite.isEnable=am;PopIn6.infinite.isStart=false;if(am){var ap=[];if(document.querySelector("._popIn_recommend")){ap.push(document.querySelector("._popIn_recommend"))}var ak=function(){var aq=function(aA,ax){var az=false;for(var ay=0,aB=ax.length;ay<aB;ay++){if(aA===ax[ay]){az=true;break}}return az};var ar=function(az){var ax=az.getAttribute("data-url");ai.templates.forEach(function(aA){if(s(aA.selector)&&aA.selectorStr==="._popIn_recommend"){aA.selector=az}});ai.setDefaults();var ay=ai.findConfig(o);if(ay){ai.apiUrl=ay.apiUrl}ai.target=ax;ai.afterConfig();an()};var at=document.querySelectorAll("._popIn_recommend");for(var au=0,aw=at.length;au<aw;au++){var av=at[au];if(!aq(av,ap)){ap.push(av);ar(av)}}};PopIn6.event.addEventListener("infinite-loading",function(aq){setInterval(ak,500)},false)}}}});C.Log={loggers:{},_addLogger:function(ak,al){this.loggers[ak]=al;for(var am in al){if(am.indexOf("_")===0){continue}this._addLogFunction(am)}},_addLogFunction:function(ak){if(s(this[ak])){return}this[ak]=function(){try{var al=Array.prototype.slice.call(arguments);PopIn6.log(function(an){var ap=C.Log.loggers[an.type];var ao=ap[ak];if(typeof ao==="function"){var aq=[an].concat(al);ao.apply(ap,aq);an.execute()}})}catch(am){console.error(am)}}}};C.Log._addLogger("basic",{_addSegmentation:function(an,am){am=am||{};var ao=[];var ap=[];var al=an.data.length-1;while(al>=0){if(an.data[al].indexOf("r5=")>-1){var ak=an.data.splice(al,1);ap.push(ak[0].split("=")[1])}al-=1}ao.push(["ca",P.category]);var aq=s(am.common_category)?am.common_category:P.common_category;if(s(ai.segmentData.abtest)){ao.push(["ab",ai.segmentData.abtest])}if(s(am.useCommonCategory)){ao.push(["cc",aq])}if(s(am.onlyCommonCategory)){ao=[["cc",aq]]}if(s(am.extra)){ao=ao.concat(am.extra)}ao.forEach(function(ar){if(s(ar[1])){var at=ar[0];var au=ar[1];au=Array.isArray(au)?au:[au];if(at==="cc"){au=[au[0]]}au.forEach(function(av){ap.push(at+"_"+encodeURIComponent(av))})}});an.add("r5",ap.join("|"))},relatedLog:function(ak){ak.mode="other";var al=/(jp|tw|kr).popin.cc/.test(ai.apiUrl)?"related-"+RegExp.$1:"related";ak.add("type",al);ak.add("uid","");ak.add("url",encodeURIComponent(ai.target));ak.uniqueId="related"},snsLog:function(ak){ak.valid=false;if(Math.random()<1/10){B("https://graph.facebook.com/?ids="+encodeURIComponent(ai.target),function(al){var ao=0;try{for(var am in al){ao+=al[am].share.share_count}}catch(ap){}if(ao>=30){ak.valid=true}var an=/(jp|tw|kr).popin.cc/.test(ai.apiUrl)?"share-"+RegExp.$1:"share-jp";ak.add("url",encodeURIComponent(ai.target));ak.add("share",ao);ak.add("type",an);ak.execute()})}},previewLog:function(ak){ak.add("url",encodeURIComponent(ai.target));ak.add("uid",PopIn6.uid);ak.add("type",ai.device+"_pv");ak.add("nid",ai.device);ak.add("media",ai.media);ak.uniqueId="pv";this._addSegmentation(ak)},boxInViewLog:function(ak){ak.add("url",encodeURIComponent(ai.target));ak.add("uid",PopIn6.uid);ak.add("type",ai.device+"_inview");ak.add("nid",ai.device);ak.add("media",ai.media);ak.uniqueId="inview";this._addSegmentation(ak)},articleClickLog:function(al,an,ak,am){al.add("url","");al.add("uid",PopIn6.uid);al.add("type",ai.device+"_rclick");al.add("nid",ai.device);al.add("media",ai.media);this._addSegmentation(al,{extra:[["ch",am.channelId]]});al.onError=ak;al.onComplete=ak},adBoxRenderedLog:function(ak,al){ak.add("url",encodeURIComponent(ai.target));ak.add("uid",PopIn6.uid);ak.add("type",ai.device+"_imp");ak.add("nid","");ak.add("media",ai.media);ak.uniqueId="imp";this._addSegmentation(ak,{onlyCommonCategory:true})},adInViewLog:function(al,am,ak){ak=ak||{};ak.common_category=s(ak.common_category)?ak.common_category:"";al.trackingPixel=am.trackingPixel;al.add("url",encodeURIComponent(ai.target));al.add("uid",PopIn6.uid);al.add("type",ai.device+"_imp");al.add("nid",am.nid);al.add("campaign",am.campaign);al.add("media",ai.media);this._addSegmentation(al,{onlyCommonCategory:true,common_category:ak.common_category});al.add("r6",am.token);if(s(am.trackingPixel)){r(am.trackingPixel)}else{if(s(am.tracking_pixel)){r(am.tracking_pixel)}}},intextBoxRenderedLog:function(ak,al){ak.add("url",encodeURIComponent(ai.target));ak.add("uid","");ak.add("type",ai.device+"_channel_pv");ak.add("nid",ai.device);ak.add("media",ai.media);this._addSegmentation(ak,{extra:[["ch",al.channelId]]})},intextBoxInViewLog:function(ak,al){ak.add("url",encodeURIComponent(ai.target));ak.add("uid","");ak.add("type",ai.device+"_channel_inview");ak.add("nid",ai.device);ak.add("media",ai.media);this._addSegmentation(ak,{extra:[["ch",al.channelId]]})},intextBoxImpLog:function(ak,al){ak.add("url",encodeURIComponent(ai.target));ak.add("uid","");ak.add("type",ai.device+"_channel_imp");ak.add("nid","");ak.add("media",ai.media);this._addSegmentation(ak,{extra:[["ch",al.channelId]]})},videoLog:function(ak,am,al){if(al=="imp"){ak.valid=false}ak.add("url",encodeURIComponent(ai.target));ak.add("uid",PopIn6.uid);ak.add("type",ai.device+"_video_"+al);ak.add("nid",am.video.nid);ak.add("campaign",am.video.campaign);ak.add("media",ai.media);ak.add("r5","cc_video");if((""+al)==="100"){this._addSegmentation(ak,{useCommonCategory:true})}ak.add("r6","video_imp")}});C.Log._addLogger("treasure",{_addSegmentation:function(am,al){al=al||{};var an=s(al.common_category)?al.common_category:P.common_category;if(s(an)){am.add("common_category",Array.isArray(an)?an[0]:an)}am.add("category",P.category);if(s(ai.segmentData.abtest)){am.add("abtest",ai.segmentData.abtest)}var ak=s(al.extra)?"m_"+al.extra[0].join("_"):"";am.add("extra",ak)},_setCommon:function(ak){ak.add("api_host",ai.apiHost);ak.add("device",ai.device);ak.add("media",ai.media);ak.add("url",ai.target);if(s(P.logid)){ak.add("logid",P.logid)}if(s(P.rid)){ak.add("rid",P.rid)}ak.add("popin_user_id",N.getUid());ak.add("smjId",PopIn6.smjId||"");var am=ak.getTrackValues();for(var al in am){ak.add(al,am[al])}ak.add("client_id",am.td_client_id)},adRequestLog:function(ak){ak.db="popin_ads";ak.table="adlogs";ak.add("type","req");ak.add("time_show_seconds",Math.round((Date.now()-M)/1000));ak.add("request_ad",ai.ad);ak.add("response_ad",P.ad.length);ak.add("smjad",(P.ad_smj&&P.ad_smj.length)>0?1:0);this._setCommon(ak);this._addSegmentation(ak)},adCriteoRequestLog:function(al,ak){al.db="popin_ads";al.table="adcriteo";al.add("type","req");al.add("time_show_seconds",Math.round((Date.now()-M)/1000));al.add("request_ad",ai.ad);al.add("response_ad",P.ad.length);this._setCommon(al);this._addSegmentation(al)},adInViewLog:function(al,am,ak){ak=ak||{};ak.common_category=s(ak.common_category)?ak.common_category:"";al.db="popin_ads";al.table="adlogs";al.add("type",am.reserved?"reserved_imp":"imp");al.add("time_show_seconds",Math.round((Date.now()-M)/1000));al.add("nid",am.nid);al.add("campaign",am.campaign);al.add("token",am.token);al.add("timestamp",Date.now());if(am.c1){al.add("c1",am.c1)}if(am.c2){al.add("c2",am.c2)}if(P.sample_tag){al.add("sample_tag",P.sample_tag)}al.add("smjad",am.isSmjAd?1:0);this._setCommon(al);this._addSegmentation(al,{common_category:ak.common_category})},adCriteoInViewLog:function(al,am,ak){ak=ak||{};ak.common_category=s(ak.common_category)?ak.common_category:"";al.db="popin_ads";al.table="adcriteo";al.add("type",am.reserved?"reserved_imp":"imp");al.add("time_show_seconds",Math.round((Date.now()-M)/1000));al.add("nid",am.nid);al.add("campaign",am.campaign);al.add("token",am.token);al.add("timestamp",Date.now());if(am.c1){al.add("c1",am.c1)}if(am.c2){al.add("c2",am.c2)}if(P.sample_tag){al.add("sample_tag",P.sample_tag)}this._setCommon(al);this._addSegmentation(al,{common_category:ak.common_category})},adClickLog:function(al,am,ak){al.db="popin_ads";al.table="adlogs";al.add("type","click");al.add("time_show_seconds",Math.round((Date.now()-M)/1000));al.add("nid",am.nid);al.add("campaign",am.campaign);al.add("token",am.token);al.add("position",am.renderPosition);al.add("timestamp",Date.now());if(am.c1){al.add("c1",am.c1)}if(am.c2){al.add("c2",am.c2)}if(P.sample_tag){al.add("sample_tag",P.sample_tag)}al.add("smjad",am.isSmjAd?1:0);this._setCommon(al);this._addSegmentation(al,{extra:[["ch",ak.channelId]]})},adMediaDnaLog:function(ak,al){ak.db="popin_media";ak.table="mediadna_clicks";ak.add("campaign_id",al.campaign);ak.add("timestamp",Date.now());this._setCommon(ak)},concatenationPVLog:function(al){var ak=window._popIn_concatenation_param;al.db="popin_media";al.table="pageview_concatenation";al.uniqueId="concatnation_pv";if(!s(ak)){al.valid=false}else{al.add("user_id",ak.user_id);al.add("useragent_popin",ak.useragent);if(location.href.indexOf("tabelog.com")>-1){al.add("pv_time",ak.pv_time);al.add("pv_hostname",location.host)}al.add("timestamp",Date.now())}},previewLog:function(ak){ak.db="popin_media";ak.table="discoverylogs";ak.uniqueId="pv";ak.add("r_url","");ak.add("type",0);this._setCommon(ak);this._addSegmentation(ak)},articleInViewLog:function(al,an){this.articleCounter=!s(this.articleCounter)?1:this.articleCounter+1;if(this.articleCounter>3){al.valid=false}al.db="popin_media";al.table="discoverylogs";al.add("r_url",an.url);al.add("type",1);al.add("recommend_type",an.type);var ak=P.identity;if(an.type==="cf"&&typeof ak==="object"){for(var am in ak){if(ak.hasOwnProperty(am)){al.add(am,ak[am])}}}this._setCommon(al);this._addSegmentation(al)},articleClickLog:function(am,ap,ak,ao){am.db="popin_media";am.table="discoverylogs";am.add("r_url",ap.url);am.add("type",2);am.add("recommend_type",ap.type);am.add("recommend_position",ap.renderPosition);var al=P.identity;if(ap.type==="cf"&&typeof al==="object"){for(var an in al){if(al.hasOwnProperty(an)){am.add(an,al[an])}}}this._setCommon(am);this._addSegmentation(am,{extra:[["ch",ao.channelId]]})},boxInViewLog:function(ak){ak.db="popin_media";ak.table="discoverylogs";ak.add("r_url","");ak.add("type",3);ak.uniqueId="inview";this._setCommon(ak);this._addSegmentation(ak)},adBoxRenderedLog:function(ak){ak.db="popin_media";ak.table="discoverylogs";ak.add("r_url","");ak.add("type",4);ak.uniqueId="imp";this._setCommon(ak);this._addSegmentation(ak)},videoLog:function(ak,am,al){ak.db="popin_ads";ak.table="adlogs";ak.add("type","video_"+al);ak.add("time_show_seconds",Math.round((Date.now()-M)/1000));ak.add("nid",am.video.nid);ak.add("campaign",am.video.campaign);ak.add("timestamp",Date.now())},videoMediaDnaLog:function(ak,am,al){ak.db="popin_media";ak.table="mediadna_clicks";ak.add("campaign_id",am.video.campaign);ak.add("timestamp",Date.now());this._setCommon(ak)},checkSmjIdLog:function(ak,an,al){ak.db="popin_ads";ak.table="smj_id";ak.add("action","localStorage");ak.add("key",PopIn6.smjId);var am=window===top?location.host:(document.referrer.match(/^https?:\/\/([^\/]+)/)||[0,""])[1];ak.add("host",am)}});C.Log._addLogger("inrecsys",{_setCommon:function(ak){var am=ak.getTrackValues();for(var al in am){ak.add(al,am[al])}ak.add("key","key"+M);ak.add("now",Date.now());ak.add("client_id",am.td_client_id);ak.add("url",ai.target);ak.add("popin_user_id",N.getUid());ak.add("smjId",PopIn6.smjId||"");ak.add("dish_media",ai.media);ak.add("dish_category",P.category||"");ak.add("dish_domain",location.host);if(s(P.logid)){ak.add("logid",P.logid)}ak.add("api_host",ai.apiHost);var an=["td_browser","td_browser_version","td_os","td_os_version"];an.forEach(function(ao){ak.add(ao,aj[ao.replace(/td_/,"")])})},_setArticleData:function(al,ao){var aq=P.common_category;if(s(aq)){al.add("dish_common_category",Array.isArray(aq)?aq[0]:aq)}al.add("dish_td_title",P.title||"");al.add("dish_pubdate",P.pubdate||"");al.add("dish_td_url",encodeURIComponent(ai.target));var ap=ao.originalUrl;var an=ao.common_category||"";al.add("fruit_common_category",Array.isArray(an)?an[0]:an);al.add("fruit_domain",X(ap).host);al.add("fruit_td_title",ao.title);al.add("fruit_pubdate",ao.pubdate);al.add("fruit_category",ao.category);al.add("fruit_td_url",ao.pureUrl);al.add("fruit_media",ao.media);al.add("fruit_image",ao.image);al.add("fruit_recommend_type",ao.type);al.add("fruit_recommend_position",ao.renderPosition);var ak=P.identity;if(ao.type==="cf"&&typeof ak==="object"){for(var am in ak){if(ak.hasOwnProperty(am)){al.add(am,ak[am])}}}},previewLog:function(ak){ak.api="other";ak.uniqueId="pv";this._setCommon(ak);ak.add("domain",location.host)},adInViewLog:function(al,am,ak){if(am.reserved){al.valid=false}al.api="ad";this._setCommon(al);al.add("type","imp");al.add("time_show_seconds",Math.round((Date.now()-M)/1000));al.add("nid",am.nid);al.add("campaign",am.campaign);al.add("token",am.token);al.add("timestamp",Date.now());if(am.c1){al.add("c1",am.c1)}if(am.c2){al.add("c2",am.c2)}if(P.sample_tag){al.add("sample_tag",P.sample_tag)}al.add("smjad",am.isSmjAd?1:0)},articleClickLog:function(al,an,ak,am){al.api="discovery";this._setCommon(al);al.add("type","click");this._setArticleData(al,an)},articleInViewLog:function(ak,al){this.articleCounter=!s(this.articleCounter)?1:this.articleCounter+1;if(this.articleCounter>3){ak.valid=false}ak.api="discovery";this._setCommon(ak);ak.add("type","imp");this._setArticleData(ak,al)}});C.Performance={isSupported:(window.performance)&&(typeof window.performance.getEntries==="function")&&(typeof window.performance.now==="function"),enableMonitor:false,sample:0.5,isResourceReady:false,db:"fe_performance",table:"base_monitor",marks:{},data:{},resourceFilterRules:[function(ak,al){if(/popin.cc\/searchbox\/.+\.js$/.test(al.name)){ak.addMark("request_config_start",al.startTime);ak.set("rcd",parseInt(al.duration,10));ak.addMark("request_config_end",al.responseEnd);return true}},function(ak,al){if(al.name.indexOf(ai.apiUrl)===0){ak.addMark("request_api_start",al.startTime);ak.set("rad",parseInt(al.duration,10));ak.addMark("request_api_end",al.responseEnd);return true}}],init:function(){if(!this.isSupported){return}var ak=ai;if(typeof ak.performanceSample==="number"){this.sample=ak.performanceSample}if(typeof ak.enablePerformanceMonitor!=="undefined"){this.enableMonitor=ak.enablePerformanceMonitor}if(H!==0||Math.random()>this.sample){this.enableMonitor=false}this.addMark("discovery_init",PopIn6.__PERFORMANCE_DISCOVERY_INIT__);if(this.enableMonitor){this.bindEvent()}return this},bindEvent:function(){var ak=this;window.addEventListener("load",function(){ak.isResourceReady=true;if(ak.marks.is_box_rendered){ak.report()}},false)},moniteBoxInview:function(){try{var am=this;var ak=[];ai.templates.forEach(function(ao){var an=ao.selector;if(ak.indexOf(an)===-1){i(an,function(){if(!am.marks.box_in_view){am.addTimeMark("box_in_view").report()}});ak.push(an)}})}catch(al){}},addTimeMark:function(ak){if(!this.isSupported){return this}if(ak==="box_did_render"&&this.marks.box_did_render!==void 0){return this}this.marks[ak]=window.performance.now();return this},addMark:function(ak,al){this.marks[ak]=al;return this},set:function(ak,al){this.data[ak]=al;return this},collectResourceInfo:function(){var ak=window.performance.getEntries();var ar=this.resourceFilterRules;var ap=ar.length;var al={};for(var an=0,ao;ao=ak[an++];){for(var am=0,aq;aq=ar[am];am++){if(!aq(this,ao)){continue}al[aq.key]=ao;ar.splice(am,1);ap--;break}if(ap===0){break}}},analyse:function(){var ak=this.data;var al=x();ak.host=al.host;ak.user_agent=al.user_agent;ak.browser=al.browser;ak.browser_version=al.browser_version;ak.os=al.os;ak.os_version=al.os_version;ak.device=G();ak.screen=al.screen;ak.api_host=ai.apiHost;ak.libLoadMode="inline";ak.di_awr=this.calculate("discovery_init","api_will_request");ak.awr_ras=this.calculate("api_will_request","request_api_start");ak.rae_adwd=this.calculate("request_api_end","api_data_will_deal");ak.adwd_bdr=this.calculate("api_data_will_deal","box_did_render");ak.bdr_biv=this.calculate("box_did_render","box_in_view");ak.total=this.calculate("request_config_start","box_did_render");ak.popin_version=6},calculate:function(am,al){var ak=this.marks;if(typeof ak[am]==="undefined"||typeof ak[al]==="undefined"){return"null"}return parseInt(ak[al]-ak[am],10)},report:function(){if(!this.enableMonitor||!this.isResourceReady||!this.marks.is_box_rendered||!this.marks.box_in_view||this.isReported){return}this.collectResourceInfo();this.analyse();if(this.data.total>0){this.log(this.data)}this.isReported=true;return this},log:function(an,am,ak){ak=ak||this.db;am=am||this.table;var al=new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:ak});al.addRecord(am,an);return this}};C.Class("Template",{init:function(al){this.setDefaults();for(var ak in al){this[ak]=al[ak]}this.selectorStr=this.selector;this.selector=document.querySelector(this.selectorStr);this.isFullClick=this.plugins.some(function(am){return am.toLowerCase().indexOf("clickall")>-1||am.toLowerCase().indexOf("fullclick")>-1})},setDefaults:function(){this.notFoundImg=window.PopIn6.protocol+"//"+U+"/images/noimg.png";this.imageInView=true;this.adVideoPosition=1;this.adVideoInsertSelector=false;this.adVideoInsertPosition="BeforeEnd";this.addTargetBlank=false;this.plugins=[];this.isFullClick=false;this.canInfiniteAds=true;this.includeRules=[];this.excludeRules=[];this.dateFormat="Y.M.D";this.isClickHistory=true}});(function(){var aq="";var ap="";var av="__pi_u_id__";var aw=/^([\d\w]{32})|(\d{13})-\d+$/;var am="https://api.popin.cc";var aC=am+"/iframe/piuid.html?ac=piuid&t=15888888";var au=null;var ar=false;C.Class("UserId",{init:function(){try{if("function"===typeof window.postMessage&&!/.+_sdk$/.test(j.pid)){aB()}ap=an(av)||"";var aF=an("_ss_pp_id")||"";if(aw.test(ap)){aq=ap.split("-")[0];return}else{al(av)}if(/^([\da-f]{32})|(\d{13})$/.test(aF)){aq=aF;ap=aF+"-"+ak();aD(av,ap);ar=true;return}else{al("_ss_pp_id")}PopIn6.event.addEventListener("result-loaded",function(aG){var aH=aG.cookie;if(aH&&aH.uid&&(!aq||ar)){aq=aH.uid;ap=aq+"-"+ak();aD(av,ap);ar=true}})}catch(aE){aA(aE)}},getUid:function(){if(!aq){ax()}return aq}});function aD(aE,aG){try{localStorage.setItem(aE,aG);return true}catch(aF){return false}}function an(aE){try{return localStorage.getItem(aE)}catch(aF){return""}}function al(aE){try{return localStorage.removeItem(aE)}catch(aF){return""}}function aB(){au=v(aC);function aE(aF){try{if(au.window!==aF.source){return}var aG=JSON.parse(aF.data);if(aG.action==="get"){az(aG.payload)}else{if(aG.action==="done"){window.removeEventListener("message",aE);au.parentNode&&au.parentNode.removeChild(au);au=null}}}catch(aH){aA(aH)}}window.addEventListener("message",aE,false)}function ao(aE){if(!aw.test(aE)){return}au.window.postMessage(JSON.stringify({action:"setId",payload:aE}),am)}function az(aG){if("string"!==typeof aG||!aw.test(aG)){ao(ap);return}if(!aq||ar){ap=aG;aq=aG.split("-")[0];aD(av,aG);ar=false;return}if(aG===ap){return}var aF=aG.split("-");var aE=ap.split("-");if(aE[1]>=aF[1]){aq=aF[0];aD(av,aG);if(aF[0]!==aE[0]&&an(av)===aG){at({previous_id:aE[0],previous_create_time:aE[1],current_id:aF[0],current_create_time:aF[1],host:top.location.host})}return}ao(ap)}function ay(aE){var aF=parseInt(Math.floor(Math.random()*Math.pow(16,aE))).toString(16);return(""+Math.pow(10,aE)+aF).slice(-aE)}function ax(){aq=[ay(8),ay(4),ay(4),ay(4),ay(12)].join("");ap=aq+"-"+ak();aD(av,ap);ar=true;return ap}function ak(){var aE=new Date;aE.setMinutes(aE.getMinutes()+aE.getTimezoneOffset());return aE.getTime()}function at(aE){if(window.Treasure2){(new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"popin_user_id"})).addRecord("uid_change_log",aE)}else{setTimeout(function(){at(aE)},1000)}}function aA(aE){if(window.Treasure2){(new window.Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:"fe_monitor"})).addRecord("err_log",{msg:aE.message||"",stack:aE.stack||"",name:aE.name||"",ua:navigator.userAgent})}else{setTimeout(function(){aA(aE)},1000)}}})();C.Class("Video",{init:function(ak,al){this.container=ak;this.template=al;this.logs={};if(typeof _popIn_noVideo_loader==="function"){PopIn6.event.addEventListener("no-video",_popIn_noVideo_loader)}if(!W.valid){return}if(G()!=="mobile"){return}var am=this.getVideo();if(s(am)){this.renderVideo(am)}},getVideo:function(){var aq=[];if(s(ai.adVideo)&&s(P.ad_video)){aq=aq.concat(P.ad_video)}if(s(ai.adReservedVideo)&&s(P.ad_reserved_video)){aq=aq.concat(P.ad_reserved_video)}if(aq.length===0){PopIn6.event.fireEvent("no-video",[])}var ap=W.session.get("_video")||"";ap=ap.split(".");var ao=[];for(var an=0;an<aq.length;an++){var am=aq[an];var al=0;for(var ak=0;ak<ap.length;ak++){if(ap[ak]===am.nid){al++}}if(al>1){continue}ao.push(am)}return ao.length>0?ao[0]:false},createContainer:function(){var ak=false;if(typeof window._popIn_video6!=="undefined"){return false}if(s(this.template.adVideoInsertSelector)){ak=document.body.querySelectorAll(this.template.adVideoInsertSelector)}else{ak=this.container.querySelectorAll("._popIn_infinite_page")}if(ak.length>0&&this.template.adVideoPosition-1<ak.length){return ak[this.template.adVideoPosition-1]}return false},renderVideo:function(am){var al=this.createContainer();if(!s(al)){return}var ak=R(document.createDocumentFragment(),"div","_popIn_infinite_video");var aq=this.template.adVideoInsertPosition.toLowerCase();if(aq==="beforebegin"){al.parentNode.insertBefore(ak,al)}if(aq==="afterbegin"){al.insertBefore(ak,al.firstChild)}if(aq==="beforeend"){al.appendChild(ak)}if(aq==="afterend"){al.parentNode.insertBefore(ak,al.nextSibling)}var at=X(ai.apiUrl);var au=[["discoveryplus.popin.cc","jp"],["jp.popin.cc","jp"],["tw.popin.cc","tw"],["kr.popin.cc","kr"],["popin.cc","jp"]];var ap="jp";for(var ar=0,ao=au.length;ar<ao;ar++){var an=au[ar];if(at.host.indexOf(an[0])>-1){ap=an[1];break}}window._popIn_video6={container:ak,data:am,logger:this,country:ap};var av=document.createElement("script");av.type="text/javascript";av.charset="UTF-8";av.async=true;av.src=window.PopIn6.protocol+"//"+U+"/popin_video6_ads-min.js";var aw=document.getElementsByTagName("script")[0];aw.parentNode.insertBefore(av,aw);return},log:function(an){var aw=an.type;var aq=aw+(s(an.value)?"_"+an.value:"");if(!s(this.logs[aq])){this.logs[aq]=1}else{this.logs[aq]++}var al=this.logs[aq];an.counter=al;var at=an.video;var ay=(s(at.type)&&at.type==="vast")?true:false;if(aw==="second"&&al>1){return}if(aw==="percent"&&al>1){return}var ax=s(at.video.background)||(s(at.video.type)&&at.video.type==="vertical");var ap=ai.apiHost;function ak(az){az.forEach(function(aA){ar(aA,true)})}function ar(az,aA){new Image().src=az+(s(aA)?"":"&t="+Date.now())}function ao(az){C.Log.videoLog(an,az)}if(aq==="full"&&ay&&s(at.ClickTracking)&&al===1){ak(at.ClickTracking)}if(aq==="second_1"){}if(s(at.video.play_time_seconds)&&aq==="second_"+at.video.play_time_seconds){var av=at.url;av+=((av.indexOf("?")>0?"&":"?")+"type="+(ax?"vertical_":"")+"imp&api_host="+ap);ar(av+"&target=c");if(ay&&s(at.Impression)){ak(at.Impression)}ao("playTimeSeconds")}if(aq==="percent_100"){var au=at.url;au+=((au.indexOf("?")>0?"&":"?")+"type=end&api_host="+ap);ar(au);if(ay&&s(at.complete)){ak(at.complete)}}if(aq==="second_2"){this.saveHistory(an);var am=at.url;am+=((am.indexOf("?")>0?"&":"?")+"type="+(ax?"vertical_":"")+"imp&api_host="+ap);ar(am+(s(at.video.play_time_seconds)?"&target=m":""));ao("imp");C.Log.videoMediaDnaLog(an,aw);if(ay&&s(at.start)){ak(at.start)}return ao("2s")}if(aq==="second_3"){return ao("3s")}if(aw==="percent"){if(an.value%25===0||an.value===95){if(ay){switch(an.value){case 25:ak(at.firstQuartile);break;case 50:ak(at.midpoint);break;case 75:ak(at.thirdQuartile);break;default:break}}return ao(""+an.value)}}if(aw==="share"){return ao("share_"+an.value)}if(!s(an.value)){return ao(aw)}},saveHistory:function(al){var ak=W.session.get("_video");if(s(ak)){ak+=("."+al.video.nid)}else{ak=al.video.nid}W.session.set("_video",ak)}});var H=0;H+=(location.href.indexOf("popintest=true")>-1?1:0);H+=(location.href.indexOf("popinadtest=true")>-1?1:0);H+=(location.href.indexOf("popinadid=")>-1?1:0);H+=(location.href.indexOf("popinadimage=")>-1?1:0);H+=(location.href.indexOf("popinvideotest=")>-1?1:0);var O="__smjidfa__";if(W.valid){PopIn6.smjId=W.local.get(O)}var N=new C.UserId();var ai=new C.Config();var P={};var M=Date.now();window.PopIn=window.PopIn||{};window.PopIn.init=function(ak){ak=ak||{};N=new C.UserId();ad=[];ai=new C.Config(ak);P={};M=Date.now();new C.Loader()};var w="";if(W.valid){w=W.local.get("_ss_pp_id")||""}var I=function(){var ao=[["news.google.co","portal_google"],["search.yahoo.co","search_yahoo"],["facebook.co","sns_facebook"],["twitter.co","sns_twitter"],["t.co$","sns_twitter"],["yahoo.co","portal_yahoo"],["goo.ne","portal_goo"],["infoseek.co","portal_infoseek"],["msn.com","portal_msn"],["excite.co.jp","portal_excite"],["livedoor.com","portal_livedoor"],["search.naver.com","search_naver"],["naver.com|naver.jp","sns_naver"],["hatena.ne.jp","sns_hatena"],["aol.jp","portal_aol"],["google.co","search_google"],["www.bing.com","search_bing"],["www.biglobe.ne.jp","portal_biglobe"],["www.smartnews.be|www.smartnews.com","app_smartnews"],["gunosy.com","app_gunosy"],["newspicks.com","app_newspicks"],["antenna.jp","app_antenna"],["paid.outbrain.com","paid_outbrain"],["trc.taboola.com","paid_yahoo"],["dsp.logly.co.jp","paid_logly"]];ao.push([location.host,"site"]);var am="other";var an=X(document.referrer).host;for(var al=0,ap=ao.length;al<ap;al++){var ak=ao[al];if(RegExp(ak[0]).test(an)){am=ak[1];break}}if(document.referrer===""){am="organic"}if(location.href.indexOf("utm_medium=logly")>-1){am="paid_logly"}return am};var t=I();C.Performance.init();try{var Q=navigator.userAgent;if(ai.checkSmjId!==false&&G()!=="pc"&&(Q.indexOf("Safari")>-1&&Q.indexOf("Chrome")<1)&&!/.+_sdk$/.test(ai.pid)&&/^https?:\/\/(jp|discoveryplus).popin.cc/.test(ai.apiUrl)){if(!PopIn6.smjId){var E=v("https://api.popin.cc/smj/get.html");var y=E.window;function aa(ak){if(y!==ak.source){return}if("string"===typeof ak.data&&ak.data!="undefined"){PopIn6.smjId=ak.data;W.valid&&W.local.set(O,ak.data)}window.removeEventListener("message",aa)}window.addEventListener("message",aa,false)}else{C.Log.checkSmjIdLog()}}}catch(ah){}new C.Loader()})();var b=function(){var q=0;var i=false;var t=function(v){q++;i=v};window.addEventListener("touchstart",t,false);window.addEventListener("click",t,false);window.addEventListener("mousedown",t,false);var r={};function s(v){if(v.valid===false){return false}if(v.uniqueId){var w=v.type+"|"+v.uniqueId;if(r[w]){return false}r[w]=1}return true}var u={};u.Class=function(w,v){this[w]=function(){if(this.init){this.init.apply(this,arguments)}};v.type=w.toLowerCase();this[w].prototype=v};u.Class("Basic",{init:function(){this.data=[];this.mode="normal"},add:function(v,w){this.data.push(v+"="+w)},imageLog:function(w){var v=new Image();if(this.onComplete){v.onload=this.onComplete}if(this.onError){v.onerror=this.onError}v.src=w},execute:function(){this.add("t",Date.now());var v=window.PopIn6.protocol;if(s(this)){switch(this.mode){case"normal":this.imageLog(v+"//rlog.popin.cc/s.gif?"+this.data.join("&"));break;case"other":this.imageLog(v+"//r.popin.cc/log.gif?"+this.data.join("&"));break}}}});u.Class("Treasure",{init:function(){this.data={}},add:function(v,w){this.data[v]=w},getTrackValues:function(){return PopIn6._logger.trackValues||{}},execute:function(){var w=new Treasure2({writeKey:"8378/25839e06ce4cc1cab55c1c1f1e49d336d6d1d48f",database:this.db});w.set("$global","td_global_id","td_global_id");this.data.interaction_number=q;if(i){if(i.touches){var x=i.touches[0];this.data.interaction_touchx=Math.round(x.pageX);this.data.interaction_touchy=Math.round(x.pageY)}if(i.type==="mousedown"){this.data.interaction_mousex=Math.round(i.pageX);this.data.interaction_mousey=Math.round(i.pageY)}}var v=this;this.add("popin_version",6);if(s(this)){w.addRecord(this.table,this.data,function(){if(v.onComplete){v.onComplete()}},function(){if(v.onError){v.onError()}})}}});u.Class("Inrecsys",{init:function(){this.data={}},getTrackValues:function(){return PopIn6._logger.trackValues||{}},add:function(v,w){this.data[v]=w},imageLog:function(w){var v=new Image();if(this.onComplete){v.onload=this.onComplete}if(this.onError){v.onerror=this.onError}v.src=w},execute:function(){this.add("popin_version",6);var v=JSON.stringify(this.data);var w=btoa(unescape(encodeURIComponent(v)));if(s(this)){this.imageLog(window.PopIn6.protocol+"//inrecsys.popin.cc/PopinService/Logs/"+this.api+"?data="+w)}}});PopIn6.log=function(v){v(new u.Basic());v(new u.Treasure());v(new u.Inrecsys())};if(PopIn6._tempLog){while(PopIn6._tempLog.length>0){PopIn6.log(PopIn6._tempLog.shift())}}};b();var d=function(r){var q=[];q.push("all-test");var t=PopIn5.$F.isMobileDevice()?"mobile":"pc";if(location.href.indexOf("popintest=true")>0){q.push(t+"-test")}q.push(t);q.push("all");for(var s=0;s<q.length;s++){var u=q[s];if(PopIn5.$F.notEmpty(o[u])&&PopIn5.$F.notEmpty(o[u][r])){return o[u][r]}}return false};if(typeof _popIn5_config["*"]==="undefined"){_popIn5_config["*"]=j}if(typeof _popIn5_config.Discovery==="undefined"){_popIn5_config.Discovery=function(){return false}}if(typeof _popIn5_config.Read==="undefined"){_popIn5_config.Read=function(){return d("Read")}}var a=false;var e=document.getElementsByTagName("script");for(var f=0,c=e.length;f<c;f++){var g=e[f];if(g.src.indexOf("popin_discovery5-min.js")>-1){a=true}}if(!a){var m=document.createElement("script"),k=window.PopIn6;m.type="text/javascript";m.charset="utf-8";m.async=true;m.src=k.protocol+"//"+k.domain+"/popin_discovery5-min.js";var p=document.getElementsByTagName("script")[0];p.parentNode.insertBefore(m,p)}return}var d=function(r){var q=[];q.push("all-test");var t=PopIn5.$F.isMobileDevice()?"mobile":"pc";if(location.href.indexOf("popintest=true")>0){q.push(t+"-test")}q.push(t);q.push("all");for(var s=0;s<q.length;s++){var u=q[s];if(PopIn5.$F.notEmpty(o[u])&&PopIn5.$F.notEmpty(o[u][r])){return o[u][r]}}return false};if(typeof _popIn5_config["*"]==="undefined"){_popIn5_config["*"]=j}if(typeof _popIn5_config.Discovery==="undefined"){_popIn5_config.Discovery=function(){return d("Discovery")}}if(typeof _popIn5_config.Read==="undefined"){_popIn5_config.Read=function(){return d("Read")}}var m=document.createElement("script");m.type="text/javascript";m.charset="utf-8";m.async=true;m.src=window.location.protocol+"//api.popin.cc/popin_discovery5-min.js";var p=document.getElementsByTagName("script")[0];p.parentNode.insertBefore(m,p)})();